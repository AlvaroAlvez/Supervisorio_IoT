<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="Cache-Control" content="no-store, no-cache, must-revalidate" />
    <meta http-equiv="Pragma" content="no-cache" />
    <meta http-equiv="Expires" content="0" />

    <title>Dashboard - Bombas</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
</head>

<body>
    <!-- Cabeçalho com ícone de engrenagem à direita -->
    <div class="header">
        <img src="/static/logo_pd7.png" id="logo" alt="Logo PD7Tech">
        <h1 class="title">Bomb Dashboard</h1>
        <a href="{{ url_for('config_form') }}" class="settings-icon" title="Configurações">
            <i class="fas fa-cog"></i>
        </a>
    </div>

    <!-- Caminhos armazenados para acesso no JavaScript -->
    <div id="imagePaths"
         data-gif="{{ url_for('static', filename='pump1.gif') }}"
         data-img="{{ url_for('static', filename='pump2.png') }}"></div>

    <div class="pump-container">
        <div class="pump">
            <h2>BOMBA 1</h2>
            <img id="pumpImage" src="{{ url_for('static', filename='pump1.gif') }}" alt="Bomba 1" onclick="togglePump()">
            <p>Status: <span id="pumpStatus" class="status-on">Ligado</span></p>
        </div>
    </div>

    <!-- Script para alternar imagem e status -->
    <script>
    const imgData = document.getElementById("imagePaths");
    const gifPath = imgData.dataset.gif;
    const imgPath = imgData.dataset.img;

    async function fetchPumpStatus() {
        try {
            const res = await fetch("/pump_status");
            const data = await res.json();
            const status = data.status;

            const img = document.getElementById("pumpImage");
            const statusText = document.getElementById("pumpStatus");

            if (status == 1) {
                img.src = gifPath;
                statusText.textContent = "Ligado";
                statusText.classList.remove("status-off");
                statusText.classList.add("status-on");
            } else {
                img.src = imgPath;
                statusText.textContent = "Desligado";
                statusText.classList.remove("status-on");
                statusText.classList.add("status-off");
            }
        } catch (error) {
            console.error("Erro ao buscar status da bomba:", error);
        }
    }

    // Atualiza a cada 1 segundo
    setInterval(fetchPumpStatus, 1000);
    // Atualiza imediatamente ao carregar
    fetchPumpStatus();
</script>
</body>
</html>
